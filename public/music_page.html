<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Symbols Animation</title>
    <link rel="stylesheet" href="music_style.css">
</head>
<body>
    <!-- Welcome Message -->
    <div id="welcome-message" class="welcome-text">
        Welcome to our Music World!
    </div>

    <!-- Music Symbols Container -->
    <div id="music-symbols-container" class="symbols-container">
        <!-- Music symbols will be generated by JavaScript -->
    </div>

    <!-- Back to Home Link -->
    <a href="https://thestrokes1.github.io/Portfolio-Cristian/" class="back-link">‚Üê Back to Home</a>

    <!-- Combined URL Manager & Controls Panel -->
    <div id="unified-manager" class="unified-manager">
        <!-- Collapsible Header with Toggle Button -->
        <div class="manager-header">
            <h3>üéµ Music Control Center</h3>
            <button id="toggle-manager" class="toggle-btn">
                <span class="toggle-icon">‚ñº</span>
            </button>
        </div>
        
        <!-- Always Visible URL Input Section -->
        <div class="always-visible-section">
            <div class="url-input-container">
                <input type="url" id="url-input" placeholder="Enter URL to add...">
                <button id="add-url-btn" class="add-url-btn">Add URL</button>
            </div>
        </div>
        
        <!-- Collapsible Content Section -->
        <div id="manager-content" class="manager-content">
            <!-- Statistics Section -->
            <div class="stats-section">
                <div class="stat-item">
                    <span class="stat-label">URLs in Pool:</span>
                    <span id="url-count" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Green Symbols:</span>
                    <span id="assigned-count" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Available:</span>
                    <span id="available-count" class="stat-value">0</span>
                </div>
            </div>
            
            <!-- Control Buttons Section -->
            <div class="control-buttons-section">
                <button id="save-btn" class="control-btn save-btn">
                    <span class="btn-icon">üíæ</span>
                    <span class="btn-text">Save Symbols</span>
                </button>
                <button id="restore-btn" class="control-btn restore-btn">
                    <span class="btn-icon">üîÑ</span>
                    <span class="btn-text">Restore All</span>
                </button>
                <button id="music-login-btn" class="control-btn login-btn" style="display: none;">
                    <span class="btn-icon">üîë</span>
                    <span class="btn-text">Login</span>
                </button>
                <button id="music-logout-btn" class="control-btn logout-btn">
                    <span class="btn-icon">üö™</span>
                    <span class="btn-text">Logout</span>
                </button>
            </div>          
            </div>
        </div>
    </div>

    <!-- Authentication Modal - This will be embedded into music_page.html -->
    <div id="auth-modal" class="auth-modal" style="display: none;">
        <div class="auth-modal-content">
            <div class="auth-modal-header">
                <h2 id="auth-title">Login</h2>
                <span class="auth-close" id="auth-close">&times;</span>
            </div>
            
            <!-- Login Form -->
            <div id="login-form" class="auth-form">
                <div class="form-group">
                    <label for="login-username">Username:</label>
                    <input type="text" id="login-username" placeholder="Enter username" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password:</label>
                    <input type="password" id="login-password" placeholder="Enter password" required>
                </div>
                <button type="button" id="login-btn" class="auth-btn">Login</button>
                <div class="auth-switch">
                    <p>Don't have an account? <a href="#" id="show-register">Register here</a></p>
                </div>
            </div>
            
            <!-- Registration Form -->
            <div id="register-form" class="auth-form" style="display: none;">
                <div class="form-group">
                    <label for="register-username">Username:</label>
                    <input type="text" id="register-username" placeholder="Choose username (min 3 chars)" required>
                </div>
                <div class="form-group">
                    <label for="register-password">Password:</label>
                    <input type="password" id="register-password" placeholder="Choose password (min 6 chars)" required>
                </div>
                <div class="form-group">
                    <label for="register-confirm">Confirm Password:</label>
                    <input type="password" id="register-confirm" placeholder="Confirm password" required>
                </div>
                <button type="button" id="register-btn" class="auth-btn">Register</button>
                <div class="auth-switch">
                    <p>Already have an account? <a href="#" id="show-login">Login here</a></p>
                </div>
            </div>
            
            <!-- User Status (when logged in) -->
            <div id="user-status" class="auth-form" style="display: none;">
                <div class="user-info">
                    <h3>Welcome, <span id="current-username"></span>!</h3>
                    <p>You are now logged in and can add URLs to symbols.</p>
                    <p style="font-size: 12px; color: rgba(255,255,255,0.6); margin-top: 10px;">Use the logout button in the control panel to sign out.</p>
                </div>
            </div>
            
            <!-- Error/Success Messages -->
            <div id="auth-message" class="auth-message"></div>
        </div>
    </div>

    <!-- Authentication Modal Styles -->
    <style>
    .auth-modal {
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
    }

    .auth-modal-content {
        background: linear-gradient(135deg, #1e3c72, #2a5298);
        margin: 10% auto;
        padding: 0;
        border: 2px solid #00ff41;
        border-radius: 15px;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 0 30px rgba(0, 255, 65, 0.3);
        animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
        from {
            transform: translateY(-50px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .auth-modal-header {
        background: rgba(0, 0, 0, 0.3);
        padding: 20px;
        border-bottom: 1px solid rgba(0, 255, 65, 0.3);
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-radius: 15px 15px 0 0;
    }

    .auth-modal-header h2 {
        color: #00ff41;
        margin: 0;
        font-size: 24px;
        text-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
    }

    .auth-close {
        color: #00ff41;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.3s ease;
    }

    .auth-close:hover {
        color: #00cc33;
    }

    .auth-form {
        padding: 30px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        color: #00ff41;
        margin-bottom: 8px;
        font-weight: bold;
        text-shadow: 0 0 5px rgba(0, 255, 65, 0.3);
    }

    .form-group input {
        width: 100%;
        padding: 12px;
        border: 2px solid rgba(0, 255, 65, 0.3);
        border-radius: 8px;
        background: rgba(0, 0, 0, 0.5);
        color: white;
        font-size: 16px;
        transition: all 0.3s ease;
    }

    .form-group input:focus {
        outline: none;
        border-color: #00ff41;
        box-shadow: 0 0 15px rgba(0, 255, 65, 0.3);
        background: rgba(0, 0, 0, 0.7);
    }

    .auth-btn {
        width: 100%;
        padding: 15px;
        background: linear-gradient(45deg, #00ff41, #00cc33);
        color: black;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .auth-btn:hover {
        background: linear-gradient(45deg, #00cc33, #009926);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 255, 65, 0.4);
    }

    .auth-btn:active {
        transform: translateY(0);
    }

    .logout-btn {
        background: linear-gradient(45deg, #ff6b6b, #ee5a52);
    }

    .logout-btn:hover {
        background: linear-gradient(45deg, #ee5a52, #dd4037);
        box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
    }

    .auth-switch {
        text-align: center;
        margin-top: 20px;
    }

    .auth-switch p {
        color: rgba(255, 255, 255, 0.8);
        margin: 0;
    }

    .auth-switch a {
        color: #00ff41;
        text-decoration: none;
        font-weight: bold;
        transition: color 0.3s ease;
    }

    .auth-switch a:hover {
        color: #00cc33;
        text-shadow: 0 0 5px rgba(0, 255, 65, 0.5);
    }

    .user-info {
        text-align: center;
        color: white;
        margin-bottom: 20px;
    }

    .user-info h3 {
        color: #00ff41;
        margin-bottom: 10px;
        text-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
    }

    .auth-message {
        padding: 15px;
        margin: 20px 30px 0 30px;
        border-radius: 8px;
        text-align: center;
        font-weight: bold;
        display: none;
    }

    .auth-message.success {
        background: rgba(0, 255, 65, 0.2);
        border: 1px solid #00ff41;
        color: #00ff41;
    }

    .auth-message.error {
        background: rgba(255, 107, 107, 0.2);
        border: 1px solid #ff6b6b;
        color: #ff6b6b;
    }

    /* Responsive Design */
    @media (max-width: 480px) {
        .auth-modal-content {
            margin: 5% auto;
            width: 95%;
        }
        
        .auth-form {
            padding: 20px;
        }
        
        .auth-modal-header {
            padding: 15px;
        }
        
        .auth-modal-header h2 {
            font-size: 20px;
        }
    }

    /* Loading Animation */
    .auth-btn.loading {
        position: relative;
        color: transparent;
    }

    .auth-btn.loading::after {
        content: "";
        position: absolute;
        width: 20px;
        height: 20px;
        top: 50%;
        left: 50%;
        margin-left: -10px;
        margin-top: -10px;
        border: 2px solid transparent;
        border-top-color: #000;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Glass Blur Effects for Boxes */
    .url-manager {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .symbol-controls {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    /* Login Button Styling */
    .login-btn {
        background: linear-gradient(45deg, #4CAF50, #45a049) !important;
        color: white !important;
    }

    .login-btn:hover {
        background: linear-gradient(45deg, #45a049, #3d8b40) !important;
        box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4) !important;
    }
    </style>

    <!-- Authentication Modal JavaScript -->
    <script>
    class AuthModal {
        constructor() {
            this.modal = document.getElementById('auth-modal');
            this.closeBtn = document.getElementById('auth-close');
            this.loginForm = document.getElementById('login-form');
            this.registerForm = document.getElementById('register-form');
            this.userStatus = document.getElementById('user-status');
            this.authTitle = document.getElementById('auth-title');
            this.authMessage = document.getElementById('auth-message');
            this.currentUsername = document.getElementById('current-username');
            
            this.token = localStorage.getItem('authToken');
            this.username = localStorage.getItem('username');
            
            this.initEventListeners();
            this.checkAuthStatus();
        }
        
        initEventListeners() {
            // Modal close events
            this.closeBtn.addEventListener('click', () => this.hide());
            this.modal.addEventListener('click', (e) => {
                if (e.target === this.modal) this.hide();
            });
            
            // Form switching
            document.getElementById('show-register').addEventListener('click', (e) => {
                e.preventDefault();
                this.showRegister();
            });
            
            document.getElementById('show-login').addEventListener('click', (e) => {
                e.preventDefault();
                this.showLogin();
            });
            
            // Form submissions
            document.getElementById('login-btn').addEventListener('click', () => this.login());
            document.getElementById('register-btn').addEventListener('click', () => this.register());
            
            // Enter key support
            ['login-username', 'login-password', 'register-username', 'register-password', 'register-confirm'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            if (id.includes('login')) this.login();
                            else this.register();
                        }
                    });
                }
            });
        }
        
        show() {
            this.modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        hide() {
            this.modal.style.display = 'none';
            document.body.style.overflow = 'auto';
            this.clearMessages();
        }
        
        showLogin() {
            this.loginForm.style.display = 'block';
            this.registerForm.style.display = 'none';
            this.userStatus.style.display = 'none';
            this.authTitle.textContent = 'Login';
            this.clearMessages();
        }
        
        showRegister() {
            this.loginForm.style.display = 'none';
            this.registerForm.style.display = 'block';
            this.userStatus.style.display = 'none';
            this.authTitle.textContent = 'Register';
            this.clearMessages();
        }
        
        showUserStatus() {
            this.loginForm.style.display = 'none';
            this.registerForm.style.display = 'none';
            this.userStatus.style.display = 'block';
            this.authTitle.textContent = 'Account';
            this.currentUsername.textContent = this.username;
            this.clearMessages();
        }
        
        showMessage(message, type = 'success') {
            this.authMessage.textContent = message;
            this.authMessage.className = `auth-message ${type}`;
            this.authMessage.style.display = 'block';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                this.clearMessages();
            }, 5000);
        }
        
        clearMessages() {
            this.authMessage.style.display = 'none';
            this.authMessage.textContent = '';
            this.authMessage.className = 'auth-message';
        }
        
        setLoading(button, loading) {
            if (loading) {
                button.classList.add('loading');
                button.disabled = true;
            } else {
                button.classList.remove('loading');
                button.disabled = false;
            }
        }
        
        async login() {
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;
            const loginBtn = document.getElementById('login-btn');
            
            if (!username || !password) {
                this.showMessage('Please enter both username and password', 'error');
                return;
            }
            
            this.setLoading(loginBtn, true);
            
            try {
                console.log('Attempting login for user:', username);
                
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                console.log('Login response status:', response.status);
                console.log('Login response headers:', response.headers);
                
                // Check if response is ok before parsing
                if (!response.ok) {
                    let errorData;
                    try {
                        const text = await response.text();
                        console.log('Error response text:', text);
                        if (text && text.trim()) {
                            try {
                                errorData = JSON.parse(text);
                                console.log('Error response data:', errorData);
                            } catch (parseError) {
                                console.error('Failed to parse error response JSON:', parseError);
                                errorData = { error: `Server error (${response.status}): ${text}` };
                            }
                        } else {
                            errorData = { error: `Server error (${response.status}): ${response.statusText}` };
                        }
                    } catch (textError) {
                        console.error('Failed to read error response text:', textError);
                        errorData = { error: `Server error (${response.status}): ${response.statusText}` };
                    }
                    throw new Error(errorData.error || 'Login failed');
                }
                
                // Parse JSON response with comprehensive error handling
                let data;
                try {
                    const text = await response.text();
                    console.log('Raw response text:', text);
                    
                    if (!text || text.trim() === '') {
                        throw new Error('Empty response from server');
                    }
                    
                    try {
                        data = JSON.parse(text);
                        console.log('Successfully parsed JSON response:', data);
                    } catch (parseError) {
                        console.error('JSON parse error:', parseError);
                        console.error('Response text that failed to parse:', text);
                        console.error('Response status:', response.status);
                        console.error('Response headers:', [...response.headers.entries()]);
                        throw new Error(`Server returned invalid JSON: ${text.substring(0, 100)}...`);
                    }
                } catch (jsonError) {
                    console.error('Response handling error:', jsonError);
                    throw new Error(jsonError.message || 'Server returned invalid JSON response');
                }
                
                console.log('Login response data:', data);
                
                if (response.ok) {
                    this.token = data.token;
                    this.username = data.user ? data.user.username : data.username;
                    
                    localStorage.setItem('authToken', this.token);
                    localStorage.setItem('username', this.username);
                    
                    this.showMessage('Login successful!', 'success');
                    this.checkAuthStatus();
                    
                    setTimeout(() => {
                        this.hide();
                        if (window.musicPage) {
                            window.musicPage.onUserLogin();
                        }
                    }, 1000);
                } else {
                    // Handle specific error cases
                    if (data.error === 'Invalid credentials') {
                        this.showMessage('Invalid username or password. Please check your credentials and try again.', 'error');
                    } else if (data.error === 'Username and password required') {
                        this.showMessage('Please enter both username and password.', 'error');
                    } else if (data.error) {
                        this.showMessage(data.error, 'error');
                    } else {
                        this.showMessage('Login failed. Please try again.', 'error');
                    }
                }
            } catch (error) {
                console.error('Login error:', error);
                
                // Provide more specific error messages
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    this.showMessage('Unable to connect to server. Please check your internet connection and try again.', 'error');
                } else if (error.name === 'SyntaxError') {
                    this.showMessage('Server returned invalid response. Please try again.', 'error');
                } else {
                    this.showMessage('An unexpected error occurred. Please try again.', 'error');
                }
            } finally {
                this.setLoading(loginBtn, false);
            }
        }
        
        async register() {
            const username = document.getElementById('register-username').value.trim();
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm').value;
            const registerBtn = document.getElementById('register-btn');
            
            if (!username || !password || !confirmPassword) {
                this.showMessage('Please fill in all fields', 'error');
                return;
            }
            
            if (username.length < 3) {
                this.showMessage('Username must be at least 3 characters', 'error');
                return;
            }
            
            if (password.length < 6) {
                this.showMessage('Password must be at least 6 characters', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                this.showMessage('Passwords do not match', 'error');
                return;
            }
            
            this.setLoading(registerBtn, true);
            
            try {
                console.log('Attempting registration for user:', username);
                
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                console.log('Registration response status:', response.status);
                console.log('Registration response headers:', response.headers);
                
                // Check if response is ok before parsing
                if (!response.ok) {
                    let errorData;
                    try {
                        const text = await response.text();
                        console.log('Error response text:', text);
                        if (text && text.trim()) {
                            try {
                                errorData = JSON.parse(text);
                                console.log('Error response data:', errorData);
                            } catch (parseError) {
                                console.error('Failed to parse error response JSON:', parseError);
                                errorData = { error: `Server error (${response.status}): ${text}` };
                            }
                        } else {
                            errorData = { error: `Server error (${response.status}): ${response.statusText}` };
                        }
                    } catch (textError) {
                        console.error('Failed to read error response text:', textError);
                        errorData = { error: `Server error (${response.status}): ${response.statusText}` };
                    }
                    throw new Error(errorData.error || 'Registration failed');
                }
                
                // Parse JSON response with comprehensive error handling
                let data;
                try {
                    const text = await response.text();
                    console.log('Raw response text:', text);
                    
                    if (!text || text.trim() === '') {
                        throw new Error('Empty response from server');
                    }
                    
                    try {
                        data = JSON.parse(text);
                        console.log('Successfully parsed JSON response:', data);
                    } catch (parseError) {
                        console.error('JSON parse error:', parseError);
                        console.error('Response text that failed to parse:', text);
                        console.error('Response status:', response.status);
                        console.error('Response headers:', [...response.headers.entries()]);
                        throw new Error(`Server returned invalid JSON: ${text.substring(0, 100)}...`);
                    }
                } catch (jsonError) {
                    console.error('Response handling error:', jsonError);
                    throw new Error(jsonError.message || 'Server returned invalid JSON response');
                }
                
                console.log('Registration response data:', data);
                
                if (response.ok) {
                    this.token = data.token;
                    this.username = data.user ? data.user.username : data.username;
                    
                    localStorage.setItem('authToken', this.token);
                    localStorage.setItem('username', this.username);
                    
                    this.showMessage('Registration successful!', 'success');
                    this.checkAuthStatus();
                    
                    setTimeout(() => {
                        this.hide();
                        if (window.musicPage) {
                            window.musicPage.onUserLogin();
                        }
                    }, 1000);
                } else {
                    // Handle specific error cases
                    if (data.error === 'Username already exists') {
                        this.showMessage('Username already exists. Please choose a different username.', 'error');
                    } else if (data.error === 'Username must be at least 3 characters') {
                        this.showMessage('Username must be at least 3 characters long.', 'error');
                    } else if (data.error === 'Password must be at least 6 characters') {
                        this.showMessage('Password must be at least 6 characters long.', 'error');
                    } else if (data.error === 'Username and password required') {
                        this.showMessage('Please fill in all required fields.', 'error');
                    } else if (data.error) {
                        this.showMessage(data.error, 'error');
                    } else {
                        this.showMessage('Registration failed. Please try again.', 'error');
                    }
                }
            } catch (error) {
                console.error('Registration error:', error);
                
                // Provide more specific error messages
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    this.showMessage('Unable to connect to server. Please check your internet connection and try again.', 'error');
                } else if (error.name === 'SyntaxError') {
                    this.showMessage('Server returned invalid response. Please try again.', 'error');
                } else {
                    this.showMessage('An unexpected error occurred. Please try again.', 'error');
                }
            } finally {
                this.setLoading(registerBtn, false);
            }
        }
        
        logout() {
            this.token = null;
            this.username = null;
            
            localStorage.removeItem('authToken');
            localStorage.removeItem('username');
            
            this.showMessage('Logged out successfully', 'success');
            
            setTimeout(() => {
                this.hide();
                this.checkAuthStatus();
                if (window.musicPage) {
                    window.musicPage.onUserLogout();
                }
            }, 1000);
        }
        
        checkAuthStatus() {
            if (this.token && this.username) {
                this.showUserStatus();
            } else {
                this.showLogin();
            }
        }
        
        isAuthenticated() {
            return !!this.token;
        }
        
        getAuthData() {
            return {
                token: this.token,
                username: this.username
            };
        }
    }

    // Initialize authentication modal when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        window.authModal = new AuthModal();
        
        // Initialize music page auth controls
        const musicLoginBtn = document.getElementById('music-login-btn');
        const musicLogoutBtn = document.getElementById('music-logout-btn');
        
        // Add click event for login button
        if (musicLoginBtn) {
            musicLoginBtn.addEventListener('click', () => {
                window.authModal.show();
            });
        }
        
        // Add click event for logout button in symbol controls
        if (musicLogoutBtn) {
            musicLogoutBtn.addEventListener('click', () => {
                window.authModal.logout();
            });
        }
        
        // Update button visibility on auth status change
        const originalCheckAuthStatus = window.authModal.checkAuthStatus.bind(window.authModal);
        window.authModal.checkAuthStatus = function() {
            originalCheckAuthStatus();
            updateAuthButtons();
        };
        
        // Update auth buttons visibility
        function updateAuthButtons() {
            const loginBtn = document.getElementById('music-login-btn');
            const logoutBtn = document.getElementById('music-logout-btn');
            
            if (window.authModal.isAuthenticated()) {
                if (loginBtn) loginBtn.style.display = 'none';
                if (logoutBtn) logoutBtn.style.display = 'inline-block';
            } else {
                if (loginBtn) loginBtn.style.display = 'inline-block';
                if (logoutBtn) logoutBtn.style.display = 'none';
            }
        }
        
        // Initial button update
        updateAuthButtons();
        
        // Override onUserLogin and onUserLogout to update buttons
        const originalOnUserLogin = window.authModal.onUserLogin || (() => {});
        const originalOnUserLogout = window.authModal.onUserLogout || (() => {});
        
        window.authModal.onUserLogin = function() {
            originalOnUserLogin.call(this);
            updateAuthButtons();
        };
        
        window.authModal.onUserLogout = function() {
            originalOnUserLogout.call(this);
            updateAuthButtons();
        };
        
        // Unified Manager Toggle Functionality
        initializeUnifiedManager();
    });

    // Initialize the unified manager collapsible functionality
    function initializeUnifiedManager() {
        const toggleBtn = document.getElementById('toggle-manager');
        const managerContent = document.getElementById('manager-content');
        const toggleIcon = toggleBtn.querySelector('.toggle-icon');
        
        if (toggleBtn && managerContent && toggleIcon) {
            let isExpanded = false; // Start collapsed
            
            toggleBtn.addEventListener('click', function() {
                isExpanded = !isExpanded;
                
                if (isExpanded) {
                    managerContent.style.display = 'block';
                    managerContent.style.maxHeight = managerContent.scrollHeight + 'px';
                    toggleIcon.textContent = '‚ñº';
                    toggleIcon.style.transform = 'rotate(0deg)';
                } else {
                    managerContent.style.maxHeight = '0';
                    managerContent.style.display = 'none';
                    toggleIcon.textContent = '‚ñ≤';
                    toggleIcon.style.transform = 'rotate(180deg)';
                }
            });
            
            // Set initial state (collapsed)
            managerContent.style.maxHeight = '0';
            managerContent.style.display = 'none';
            toggleIcon.textContent = '‚ñ≤';
            toggleIcon.style.transform = 'rotate(180deg)';
        }
    }
    </script>

    <script src="music_script.js"></script>
</body>
</html>
